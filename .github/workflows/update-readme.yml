# üîπ –û–Ω —Å–æ–±–∏—Ä–∞–µ—Ç README.md –∏–∑ —Ç—Ä—ë—Ö —á–∞—Å—Ç–µ–π
# üîπ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤ –≤ `.github/README_PARTS/`
# üîπ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –≤–µ—Ç–∫—É main ## –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—à–∏—Ç—å –≤ –¥—Ä—É–≥—É—é –≤–µ—Ç–∫—É —Ç–æ –≤–∫–æ–Ω—Ü–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–µ–Ω—è–µ–º `main` –≤ `HEAD:main` –Ω–∞ –≤–∞—à—É –≤–µ—Ç–∫—É
# üîπ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö GitHub runners (ubuntu-latest)

name: Build README from parts

on:
  workflow_dispatch: # —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  push:
    paths:
    - ".github/README_PARTS/*" # —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

jobs:
  build-readme:
    runs-on: ubuntu-latest
    name: üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è README.md –∏–∑ —á–∞—Å—Ç–µ–π
    steps:
    - name: üîÑ –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–ø—É—Å–∫–µ
      run: |
        echo "üéâ –ó–∞–ø—É—â–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ–º ${{ github.event_name }}"
        echo "üêß –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: ${{ runner.os }}"

    - name: üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–∏—Ç–æ–≤
        clean: true # –æ—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π

    - name: üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"

    - name: üìÇ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–µ–π README
      run: |
        HEADER=".github/README_PARTS/1.HEADER.md"
        DESCRIPTION=".github/README_PARTS/2.DESCRIPTION.md"
        DONATION=".github/README_PARTS/3.DONATION.md"
        NAV=".github/README_PARTS/4.NAV.md"
        MAIN=".github/README_PARTS/5.MAIN.md"
        FOOTER=".github/README_PARTS/6.FOOTER.md"
        OUTPUT="README.md"

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
        if [[ ! -f "$HEADER" || ! -f "$DESCRIPTION" || ! -f "$FOOTER" ]]; then
          echo "‚ùå –û—à–∏–±–∫–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–¥–∏–Ω –∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤!"
          exit 1
        fi

        # –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —á–∞—Å—Ç–∏ —Å –¥–≤—É–º—è –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏
        cat "$HEADER" > "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"
        cat "$DESCRIPTION" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"
        cat "$DONATION" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"
        cat "$NAV" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"
        cat "$MAIN" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"
        cat "$FOOTER" >> "$OUTPUT"
        echo -e "\n\n" >> "$OUTPUT"


        echo "‚úÖ README.md —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω."

    - name: üíæ Commit –∏ Push README
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git add README.md
        git commit -m "Auto-generate README from parts" || echo "‚ÑπÔ∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏"
        git push "https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git" HEAD:main
